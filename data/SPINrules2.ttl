@prefix xsd:   <http://www.w3.org/2001/XMLSchema#> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl:     <http://www.w3.org/2002/07/owl#> .

@prefix ca: <http://floss.syr.edu/ontologies/2008/4/contentAnalysis.owl#> .
@prefix doap: <http://usefulinc.com/ns/doap#> .

@prefix bioj: <http://james.howison.name/ontologies/bio-journal-sample#> .
@prefix citec: <http://james.howison.name/ontologies/software-citation-coding#> .
@prefix bioj-cited: <http://james.howison.name/ontologies/bio-journal-sample-citation#> .

@prefix dc: <http://dublincore.org/documents/2012/06/14/dcmi-terms/> .

@prefix sp:      <http://spinrdf.org/sp#> .
@prefix spin:    <http://spinrdf.org/spin#> .
@prefix spl:     <http://spinrdf.org/spl#> .

bioj:SoftwareMention a rdfs:Class ;
            spin:rule [ rdf:type sp:Construct ;
			sp:text """
	# Create software packages for each non-alternative
	CONSTRUCT {
	  ?software_package a bioj:SoftwarePackage ;
	                    rdfs:label ?name ;
						bioj:mentioned_in ?this .
	  ?this bioj:mentions_software ?software_package ;
	           
	}
	WHERE {
	  ?this  rdf:type bioj:SoftwareMention ;
	  		 citec:original_name ?name .
	  FILTER NOT EXISTS { ?this bioj:mentions_software ?software }
	  BIND (
		 URI(CONCAT("http://james.howison.name/ontologies/software-citation-coding#software-",
		            ENCODE_FOR_URI(?name)
			       )
		    ) as ?software_package )
	}"""
] ;
            spin:rule [ rdf:type sp:Construct ;
			sp:text """
	# Create ArticleSoftwareLinks
	CONSTRUCT {
	  ?article_software_link rdf:type bioj:ArticleSoftwareLink ;
	  	        bioj:mentions_software ?software_package ;
				citec:from_article ?article ;
				citec:from_mention ?this .
	  ?this citec:article_software_link ?article_software_link .
	}
	WHERE {
	  ?this  rdf:type bioj:SoftwareMention ;
	  		 citec:original_name ?name ;
			 bioj:mentions_software ?software_package ;
			 bioj:from_selection ?selection .
	  ?article bioj:has_selection ?selection .
	   	  BIND (
	   		 URI(CONCAT("http://james.howison.name/ontologies/bio-journal-sample#",
	   		            REPLACE(str(?article), '^.*(#|/)', ""),
						"-",
						ENCODE_FOR_URI(?name)
	   			       )
	   		    ) as ?article_software_link )
	}"""
] ;
.

bioj:ArticleSoftwareLink a rdfs:Class ;
    spin:rule [ rdf:type sp:Construct ;
	sp:text """
	# Move identifiable true code to ArticleSoftwareLink
	# True if any are true, but that is dealt with later.
	CONSTRUCT {
		?this citec:is_identifiable true .
	}
	WHERE {
		?this rdf:type bioj:ArticleSoftwareLink ;
		      citec:from_mention ?mention .
		?mention bioj:from_selection ?sel .
		{ 
			?sel 	ca:isTargetOf   [ ca:appliesCode [ rdf:type citec:identifiable ] ] ;
		} UNION {
			?sel bioj:has_reference ?ref .
			?ref 	ca:isTargetOf   [ ca:appliesCode [ rdf:type citec:identifiable ] ] ;
		}
	}"""
] ;
    spin:rule [ rdf:type sp:Construct ;
	sp:text """
	# Move findable true code to ArticleSoftwareLink
	# True if any selections were coded findable; false dealt with later.
	CONSTRUCT {
		?this citec:is_findable true .
	}
	WHERE {
		?this rdf:type bioj:ArticleSoftwareLink ;
		      citec:from_mention ?mention .
		?mention bioj:from_selection ?sel .
		{ 
			?sel 	ca:isTargetOf   [ ca:appliesCode [ rdf:type citec:findable ] ] ;
		} UNION {
			?sel  bioj:has_reference ?ref .
			?ref 	ca:isTargetOf   [ ca:appliesCode [ rdf:type citec:findable ] ] ;
		}
	}"""
] ;
    spin:rule [ rdf:type sp:Construct ;
	sp:text """
	# Interpret creator codes.
	CONSTRUCT {
		?this citec:is_credited true .
	}
	WHERE {
		?this rdf:type bioj:ArticleSoftwareLink ;
		      citec:from_mention ?mention .
		?mention bioj:from_selection ?sel .
		{ 
			?sel 	ca:isTargetOf   [ ca:appliesCode [ rdf:type citec:creator ] ] ;
		} UNION {
			?sel  bioj:has_reference ?ref .
			?ref 	ca:isTargetOf   [ ca:appliesCode [ rdf:type citec:creator ] ] ;
		}
	}"""
] ;


.


bioj:SoftwarePackage a rdfs:Class ;
    spin:rule [ rdf:type sp:Construct ;
	sp:text """
	# Interpret software package codes
	CONSTRUCT {
		?this citec:is_accessible true
	}
	WHERE {
		?this rdf:type bioj:SoftwarePackage ;
		      bioj:mentioned_in ?mention .
		?mention bioj:from_selection ?sel .
		{ 
			?sel ca:isTargetOf [ ca:appliesCode [ rdf:type ?code ] ] . 
		} UNION {
			?sel bioj:has_reference ?ref . 
	        ?ref ca:isTargetOf [ ca:appliesCode [ rdf:type ?code ] ] .
		}
		FILTER (?code = citec:access_purchase || ?code = citec:access_free)
	}"""
] ;
    spin:rule [ rdf:type sp:Construct ;
	sp:text """
	# Interpret software package codes
	CONSTRUCT {
		?this citec:is_accessible false
	}
	WHERE {
		?this rdf:type bioj:SoftwarePackage ;
		      bioj:mentioned_in ?mention .
		?mention bioj:from_selection ?sel .
		{ 
			?sel ca:isTargetOf [ ca:appliesCode [ rdf:type citec:no_access ] ] . 
		} UNION {
			?sel bioj:has_reference ?ref . 
	        ?ref ca:isTargetOf [ ca:appliesCode [ rdf:type citec:no_access ] ] .
		}
	}"""
] ;
    spin:rule [ rdf:type sp:Construct ;
	sp:text """
	# Interpret software package codes
	CONSTRUCT {
		?this citec:is_source_accessible true
	}
	WHERE {
		?this rdf:type bioj:SoftwarePackage ;
		      bioj:mentioned_in ?mention .
		?mention bioj:from_selection ?sel .
		{ 
			?sel ca:isTargetOf [ ca:appliesCode [ rdf:type citec:source_available ] ] . 
		} UNION {
			?sel bioj:has_reference ?ref . 
	        ?ref ca:isTargetOf [ ca:appliesCode [ rdf:type citec:source_available ] ] .
		}
	}"""
] ;
    spin:rule [ rdf:type sp:Construct ;
	sp:text """
	# Interpret software package codes
	CONSTRUCT {
		?this citec:is_source_accessible false
	}
	WHERE {
		?this rdf:type bioj:SoftwarePackage ;
		      bioj:mentioned_in ?mention .
		?mention bioj:from_selection ?sel .
		{ 
			?sel ca:isTargetOf [ ca:appliesCode [ rdf:type citec:source_unavailable ] ] . 
		} UNION {
			?sel bioj:has_reference ?ref . 
	        ?ref ca:isTargetOf [ ca:appliesCode [ rdf:type citec:source_unavailable ] ] .
		}
	}"""
] ;
    spin:rule [ rdf:type sp:Construct ;
	sp:text """
	# Interpret software package codes
	CONSTRUCT {
		?this citec:is_explicitly_modifiable true
	}
	WHERE {
		?this rdf:type bioj:SoftwarePackage ;
		      bioj:mentioned_in ?mention .
		?mention bioj:from_selection ?sel .
		{ 
			?sel ca:isTargetOf [ ca:appliesCode [ rdf:type citec:permission_modify ] ] . 
		} UNION {
			?sel bioj:has_reference ?ref . 
	        ?ref ca:isTargetOf [ ca:appliesCode [ rdf:type citec:permission_modify ] ] .
		}
	}"""
] ;    spin:rule [ rdf:type sp:Construct ;
	sp:text """
	# Interpret software package codes
	CONSTRUCT {
		?this citec:is_explicitly_modifiable false
	}
	WHERE {
		?this rdf:type bioj:SoftwarePackage ;
		      bioj:mentioned_in ?mention .
		?mention bioj:from_selection ?sel .
		{ 
			?sel ca:isTargetOf [ ca:appliesCode [ rdf:type citec:prohibited_modify ] ] . 
		} UNION {
			?sel bioj:has_reference ?ref . 
	        ?ref ca:isTargetOf [ ca:appliesCode [ rdf:type citec:prohibited_modify ] ] .
		}
	}"""
] ;

.

