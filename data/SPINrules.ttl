@prefix xsd:   <http://www.w3.org/2001/XMLSchema#> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl:     <http://www.w3.org/2002/07/owl#> .

@prefix ca: <http://floss.syr.edu/ontologies/2008/4/contentAnalysis.owl#> .
@prefix doap: <http://usefulinc.com/ns/doap#> .

@prefix bioj: <http://james.howison.name/ontologies/bio-journal-sample#> .
@prefix citec: <http://james.howison.name/ontologies/software-citation-coding#> .
@prefix bioj-cited: <http://james.howison.name/ontologies/bio-journal-sample#> .

@prefix dc: <http://dublincore.org/documents/2012/06/14/dcmi-terms/> .

@prefix sp:      <http://spinrdf.org/sp#> .
@prefix spin:    <http://spinrdf.org/spin#> .
@prefix spl:     <http://spinrdf.org/spl#> .

bioj:article a rdfs:Class ;	
	spin:rule [ rdf:type sp:Construct ;	
				sp:text """
	# Asserts a new type for articles with any selections coded as mentions
	PREFIX ca: <http://floss.syr.edu/ontologies/2008/4/contentAnalysis.owl#>
	PREFIX bioj: <http://james.howison.name/ontologies/bio-journal-sample#>
	PREFIX citec: <http://james.howison.name/ontologies/software-citation-coding#>
	CONSTRUCT {
	  ?this rdf:type bioj:ArticleWithMention .
	} 
	WHERE {
	  ?this rdf:type bioj:article ;
	        bioj:has_selection ?sel .
	  ?sel  ca:isTargetOf [ ca:appliesCode [ rdf:type citec:in-text_mention ] ] .
	  OPTIONAL { 
	        ?sel bioj:has_reference ?ref .
	        ?ref ca:isTargetOf [ ca:appliesCode [ rdf:type ?code ] ] .
	  }
	}
				"""
	] .